"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[330],{9365:function(d,b,a){a.d(b,{z:function(){return h}});var c=a(9477);const e={type:"change"},f={type:"start"},g={type:"end"};class h extends c.pBf{constructor(d,b){super(),void 0===b&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),b===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=d,this.domElement=b,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new c.Pa4,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:c.RsA.ROTATE,MIDDLE:c.RsA.DOLLY,RIGHT:c.RsA.PAN},this.touches={ONE:c.QmN.ROTATE,TWO:c.QmN.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return o.phi},this.getAzimuthalAngle=function(){return o.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(a){a.addEventListener("keydown",Z),this._domElementKeyEvents=a},this.saveState=function(){a.target0.copy(a.target),a.position0.copy(a.object.position),a.zoom0=a.object.zoom},this.reset=function(){a.target.copy(a.target0),a.object.position.copy(a.position0),a.object.zoom=a.zoom0,a.object.updateProjectionMatrix(),a.dispatchEvent(e),a.update(),m=h.NONE},this.update=function(){const f=new c.Pa4,b=new c._fP().setFromUnitVectors(d.up,new c.Pa4(0,1,0)),g=b.clone().invert(),i=new c.Pa4,j=new c._fP,k=2*Math.PI;return function(){const l=a.object.position;f.copy(l).sub(a.target),f.applyQuaternion(b),o.setFromVector3(f),a.autoRotate&&m===h.NONE&&G(E()),a.enableDamping?(o.theta+=p.theta*a.dampingFactor,o.phi+=p.phi*a.dampingFactor):(o.theta+=p.theta,o.phi+=p.phi);let c=a.minAzimuthAngle,d=a.maxAzimuthAngle;return isFinite(c)&&isFinite(d)&&(c< -Math.PI?c+=k:c>Math.PI&&(c-=k),d< -Math.PI?d+=k:d>Math.PI&&(d-=k),c<=d?o.theta=Math.max(c,Math.min(d,o.theta)):o.theta=o.theta>(c+d)/2?Math.max(c,o.theta):Math.min(d,o.theta)),o.phi=Math.max(a.minPolarAngle,Math.min(a.maxPolarAngle,o.phi)),o.makeSafe(),o.radius*=q,o.radius=Math.max(a.minDistance,Math.min(a.maxDistance,o.radius)),!0===a.enableDamping?a.target.addScaledVector(r,a.dampingFactor):a.target.add(r),f.setFromSpherical(o),f.applyQuaternion(g),l.copy(a.target).add(f),a.object.lookAt(a.target),!0===a.enableDamping?(p.theta*=1-a.dampingFactor,p.phi*=1-a.dampingFactor,r.multiplyScalar(1-a.dampingFactor)):(p.set(0,0,0),r.set(0,0,0)),q=1,!!(s||i.distanceToSquared(a.object.position)>n||8*(1-j.dot(a.object.quaternion))>n)&&(a.dispatchEvent(e),i.copy(a.object.position),j.copy(a.object.quaternion),s=!1,!0)}}(),this.dispose=function(){a.domElement.removeEventListener("contextmenu",l),a.domElement.removeEventListener("pointerdown",i),a.domElement.removeEventListener("pointercancel",j),a.domElement.removeEventListener("wheel",k),a.domElement.removeEventListener("pointermove",V),a.domElement.removeEventListener("pointerup",W),null!==a._domElementKeyEvents&&a._domElementKeyEvents.removeEventListener("keydown",Z)};const a=this,h={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let m=h.NONE;const n=1e-6,o=new c.$V,p=new c.$V;let q=1;const r=new c.Pa4;let s=!1;const t=new c.FM8,u=new c.FM8,v=new c.FM8,w=new c.FM8,x=new c.FM8,y=new c.FM8,z=new c.FM8,A=new c.FM8,B=new c.FM8,C=[],D={};function E(){return 2*Math.PI/60/60*a.autoRotateSpeed}function F(){return Math.pow(.95,a.zoomSpeed)}function G(a){p.theta-=a}function H(a){p.phi-=a}const I=function(){const a=new c.Pa4;return function(b,c){a.setFromMatrixColumn(c,0),a.multiplyScalar(-b),r.add(a)}}(),J=function(){const b=new c.Pa4;return function(d,c){!0===a.screenSpacePanning?b.setFromMatrixColumn(c,1):(b.setFromMatrixColumn(c,0),b.crossVectors(a.object.up,b)),b.multiplyScalar(d),r.add(b)}}(),K=function(){const b=new c.Pa4;return function(d,e){const c=a.domElement;if(a.object.isPerspectiveCamera){const g=a.object.position;b.copy(g).sub(a.target);let f=b.length();I(2*d*(f*=Math.tan(a.object.fov/2*Math.PI/180))/c.clientHeight,a.object.matrix),J(2*e*f/c.clientHeight,a.object.matrix)}else a.object.isOrthographicCamera?(I(d*(a.object.right-a.object.left)/a.object.zoom/c.clientWidth,a.object.matrix),J(e*(a.object.top-a.object.bottom)/a.object.zoom/c.clientHeight,a.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),a.enablePan=!1)}}();function L(b){a.object.isPerspectiveCamera?q/=b:a.object.isOrthographicCamera?(a.object.zoom=Math.max(a.minZoom,Math.min(a.maxZoom,a.object.zoom*b)),a.object.updateProjectionMatrix(),s=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),a.enableZoom=!1)}function M(b){a.object.isPerspectiveCamera?q*=b:a.object.isOrthographicCamera?(a.object.zoom=Math.max(a.minZoom,Math.min(a.maxZoom,a.object.zoom/b)),a.object.updateProjectionMatrix(),s=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),a.enableZoom=!1)}function N(a){t.set(a.clientX,a.clientY)}function O(a){w.set(a.clientX,a.clientY)}function P(){if(1===C.length)t.set(C[0].pageX,C[0].pageY);else{const a=.5*(C[0].pageX+C[1].pageX),b=.5*(C[0].pageY+C[1].pageY);t.set(a,b)}}function Q(){if(1===C.length)w.set(C[0].pageX,C[0].pageY);else{const a=.5*(C[0].pageX+C[1].pageX),b=.5*(C[0].pageY+C[1].pageY);w.set(a,b)}}function R(){const a=C[0].pageX-C[1].pageX,b=C[0].pageY-C[1].pageY;z.set(0,Math.sqrt(a*a+b*b))}function S(b){if(1==C.length)u.set(b.pageX,b.pageY);else{const c=ad(b),e=.5*(b.pageX+c.x),f=.5*(b.pageY+c.y);u.set(e,f)}v.subVectors(u,t).multiplyScalar(a.rotateSpeed);const d=a.domElement;G(2*Math.PI*v.x/d.clientHeight),H(2*Math.PI*v.y/d.clientHeight),t.copy(u)}function T(b){if(1===C.length)x.set(b.pageX,b.pageY);else{const c=ad(b),d=.5*(b.pageX+c.x),e=.5*(b.pageY+c.y);x.set(d,e)}y.subVectors(x,w).multiplyScalar(a.panSpeed),K(y.x,y.y),w.copy(x)}function U(b){const c=ad(b),d=b.pageX-c.x,e=b.pageY-c.y;A.set(0,Math.sqrt(d*d+e*e)),B.set(0,Math.pow(A.y/z.y,a.zoomSpeed)),L(B.y),z.copy(A)}function i(b){!1!==a.enabled&&(0===C.length&&(a.domElement.setPointerCapture(b.pointerId),a.domElement.addEventListener("pointermove",V),a.domElement.addEventListener("pointerup",W)),aa(b),"touch"===b.pointerType?$(b):X(b))}function V(b){!1!==a.enabled&&("touch"===b.pointerType?_(b):Y(b))}function W(b){ab(b),0===C.length&&(a.domElement.releasePointerCapture(b.pointerId),a.domElement.removeEventListener("pointermove",V),a.domElement.removeEventListener("pointerup",W)),a.dispatchEvent(g),m=h.NONE}function j(a){ab(a)}function X(b){let d;switch(b.button){case 0:d=a.mouseButtons.LEFT;break;case 1:d=a.mouseButtons.MIDDLE;break;case 2:d=a.mouseButtons.RIGHT;break;default:d=-1}switch(d){case c.RsA.DOLLY:var e;if(!1===a.enableZoom)return;e=b,z.set(e.clientX,e.clientY),m=h.DOLLY;break;case c.RsA.ROTATE:if(b.ctrlKey||b.metaKey||b.shiftKey){if(!1===a.enablePan)return;O(b),m=h.PAN}else{if(!1===a.enableRotate)return;N(b),m=h.ROTATE}break;case c.RsA.PAN:if(b.ctrlKey||b.metaKey||b.shiftKey){if(!1===a.enableRotate)return;N(b),m=h.ROTATE}else{if(!1===a.enablePan)return;O(b),m=h.PAN}break;default:m=h.NONE}m!==h.NONE&&a.dispatchEvent(f)}function Y(b){var c,d;if(!1!==a.enabled)switch(m){case h.ROTATE:if(!1===a.enableRotate)return;!function(b){u.set(b.clientX,b.clientY),v.subVectors(u,t).multiplyScalar(a.rotateSpeed);const c=a.domElement;G(2*Math.PI*v.x/c.clientHeight),H(2*Math.PI*v.y/c.clientHeight),t.copy(u),a.update()}(b);break;case h.DOLLY:if(!1===a.enableZoom)return;c=b,A.set(c.clientX,c.clientY),B.subVectors(A,z),B.y>0?L(F()):B.y<0&&M(F()),z.copy(A),a.update();break;case h.PAN:if(!1===a.enablePan)return;d=b,x.set(d.clientX,d.clientY),y.subVectors(x,w).multiplyScalar(a.panSpeed),K(y.x,y.y),w.copy(x),a.update();break}}function k(b){if(!1!==a.enabled&& !1!==a.enableZoom&&m===h.NONE){var c;b.preventDefault(),a.dispatchEvent(f),(c=b).deltaY<0?M(F()):c.deltaY>0&&L(F()),a.update(),a.dispatchEvent(g)}}function Z(b){!1!==a.enabled&& !1!==a.enablePan&&function(c){let b=!1;switch(c.code){case a.keys.UP:K(0,a.keyPanSpeed),b=!0;break;case a.keys.BOTTOM:K(0,-a.keyPanSpeed),b=!0;break;case a.keys.LEFT:K(a.keyPanSpeed,0),b=!0;break;case a.keys.RIGHT:K(-a.keyPanSpeed,0),b=!0;break}b&&(c.preventDefault(),a.update())}(b)}function $(b){switch(ac(b),C.length){case 1:switch(a.touches.ONE){case c.QmN.ROTATE:if(!1===a.enableRotate)return;P(),m=h.TOUCH_ROTATE;break;case c.QmN.PAN:if(!1===a.enablePan)return;Q(),m=h.TOUCH_PAN;break;default:m=h.NONE}break;case 2:switch(a.touches.TWO){case c.QmN.DOLLY_PAN:if(!1===a.enableZoom&& !1===a.enablePan)return;a.enableZoom&&R(),a.enablePan&&Q(),m=h.TOUCH_DOLLY_PAN;break;case c.QmN.DOLLY_ROTATE:if(!1===a.enableZoom&& !1===a.enableRotate)return;a.enableZoom&&R(),a.enableRotate&&P(),m=h.TOUCH_DOLLY_ROTATE;break;default:m=h.NONE}break;default:m=h.NONE}m!==h.NONE&&a.dispatchEvent(f)}function _(b){var c,d;switch(ac(b),m){case h.TOUCH_ROTATE:if(!1===a.enableRotate)return;S(b),a.update();break;case h.TOUCH_PAN:if(!1===a.enablePan)return;T(b),a.update();break;case h.TOUCH_DOLLY_PAN:if(!1===a.enableZoom&& !1===a.enablePan)return;c=b,a.enableZoom&&U(c),a.enablePan&&T(c),a.update();break;case h.TOUCH_DOLLY_ROTATE:if(!1===a.enableZoom&& !1===a.enableRotate)return;d=b,a.enableZoom&&U(d),a.enableRotate&&S(d),a.update();break;default:m=h.NONE}}function l(b){!1!==a.enabled&&b.preventDefault()}function aa(a){C.push(a)}function ab(b){delete D[b.pointerId];for(let a=0;a<C.length;a++)if(C[a].pointerId==b.pointerId){C.splice(a,1);return}}function ac(a){let b=D[a.pointerId];void 0===b&&(b=new c.FM8,D[a.pointerId]=b),b.set(a.pageX,a.pageY)}function ad(a){const b=a.pointerId===C[0].pointerId?C[1]:C[0];return D[b.pointerId]}a.domElement.addEventListener("contextmenu",l),a.domElement.addEventListener("pointerdown",i),a.domElement.addEventListener("pointercancel",j),a.domElement.addEventListener("wheel",k,{passive:!1}),this.update()}}},1217:function(e,d,c){c.d(d,{E:function(){return f}});var a=c(9477);class f extends a.aNw{constructor(a){super(a),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(a){return new j(a)}),this.register(function(a){return new p(a)}),this.register(function(a){return new q(a)}),this.register(function(a){return new k(a)}),this.register(function(a){return new l(a)}),this.register(function(a){return new m(a)}),this.register(function(a){return new n(a)}),this.register(function(a){return new o(a)}),this.register(function(a){return new h(a)}),this.register(function(a){return new r(a)})}load(c,g,d,h){const i=this;let e;e=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:a.Zp0.extractUrlBase(c),this.manager.itemStart(c);const f=function(a){h?h(a):console.error(a),i.manager.itemError(c),i.manager.itemEnd(c)},b=new a.hH6(this.manager);b.setPath(this.path),b.setResponseType("arraybuffer"),b.setRequestHeader(this.requestHeader),b.setWithCredentials(this.withCredentials),b.load(c,function(a){try{i.parse(a,e,function(a){g(a),i.manager.itemEnd(c)},f)}catch(b){f(b)}},d,f)}setDRACOLoader(a){return this.dracoLoader=a,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(a){return this.ktx2Loader=a,this}setMeshoptDecoder(a){return this.meshoptDecoder=a,this}register(a){return -1===this.pluginCallbacks.indexOf(a)&&this.pluginCallbacks.push(a),this}unregister(a){return -1!==this.pluginCallbacks.indexOf(a)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(a),1),this}parse(e,o,p,f){let j;const b={},k={};if("string"==typeof e)j=e;else{const q=a.Zp0.decodeText(new Uint8Array(e,0,4));if(q===s){try{b[g.KHR_BINARY_GLTF]=new v(e)}catch(r){f&&f(r);return}j=b[g.KHR_BINARY_GLTF].content}else j=a.Zp0.decodeText(new Uint8Array(e))}const d=JSON.parse(j);if(void 0===d.asset||d.asset.version[0]<2){f&&f(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const h=new T(d,{path:o||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});h.fileLoader.setRequestHeader(this.requestHeader);for(let l=0;l<this.pluginCallbacks.length;l++){const m=this.pluginCallbacks[l](h);k[m.name]=m,b[m.name]=!0}if(d.extensionsUsed)for(let n=0;n<d.extensionsUsed.length;++n){const c=d.extensionsUsed[n],t=d.extensionsRequired||[];switch(c){case g.KHR_MATERIALS_UNLIT:b[c]=new i;break;case g.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:b[c]=new z;break;case g.KHR_DRACO_MESH_COMPRESSION:b[c]=new w(d,this.dracoLoader);break;case g.KHR_TEXTURE_TRANSFORM:b[c]=new x;break;case g.KHR_MESH_QUANTIZATION:b[c]=new A;break;default:t.indexOf(c)>=0&& void 0===k[c]&&console.warn('THREE.GLTFLoader: Unknown extension "'+c+'".')}}h.setExtensions(b),h.setPlugins(k),h.parse(p,f)}parseAsync(a,b){const c=this;return new Promise(function(d,e){c.parse(a,b,d,e)})}}const g={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class h{constructor(a){this.parser=a,this.name=g.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const d=this.parser,c=this.parser.json.nodes||[];for(let b=0,e=c.length;b<e;b++){const a=c[b];a.extensions&&a.extensions[this.name]&& void 0!==a.extensions[this.name].light&&d._addNodeRef(this.cache,a.extensions[this.name].light)}}_loadLight(g){const e=this.parser,h="light:"+g;let d=e.cache.get(h);if(d)return d;const i=e.json,k=i.extensions&&i.extensions[this.name]||{},l=k.lights||[],b=l[g];let c;const f=new a.Ilk(16777215);void 0!==b.color&&f.fromArray(b.color);const j=void 0!==b.range?b.range:0;switch(b.type){case"directional":(c=new a.Ox3(f)).target.position.set(0,0,-1),c.add(c.target);break;case"point":(c=new a.cek(f)).distance=j;break;case"spot":(c=new a.PMe(f)).distance=j,b.spot=b.spot||{},b.spot.innerConeAngle=void 0!==b.spot.innerConeAngle?b.spot.innerConeAngle:0,b.spot.outerConeAngle=void 0!==b.spot.outerConeAngle?b.spot.outerConeAngle:Math.PI/4,c.angle=b.spot.outerConeAngle,c.penumbra=1-b.spot.innerConeAngle/b.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+b.type)}return c.position.set(0,0,0),c.decay=2,void 0!==b.intensity&&(c.intensity=b.intensity),c.name=e.createUniqueName(b.name||"light_"+g),d=Promise.resolve(c),e.cache.add(h,d),d}createNodeAttachment(c){const g=this,d=this.parser,e=d.json,a=e.nodes[c],f=a.extensions&&a.extensions[this.name]||{},b=f.light;return void 0===b?null:this._loadLight(b).then(function(a){return d._getNodeRef(g.cache,b,a)})}}class i{constructor(){this.name=g.KHR_MATERIALS_UNLIT}getMaterialType(){return a.vBJ}extendParams(b,f,g){const d=[];b.color=new a.Ilk(1,1,1),b.opacity=1;const c=f.pbrMetallicRoughness;if(c){if(Array.isArray(c.baseColorFactor)){const e=c.baseColorFactor;b.color.fromArray(e),b.opacity=e[3]}void 0!==c.baseColorTexture&&d.push(g.assignTexture(b,"map",c.baseColorTexture,a.knz))}return Promise.all(d)}}class j{constructor(a){this.parser=a,this.name=g.KHR_MATERIALS_CLEARCOAT}getMaterialType(c){const d=this.parser,b=d.json.materials[c];return b.extensions&&b.extensions[this.name]?a.EJi:null}extendMaterialParams(h,c){const d=this.parser,f=d.json.materials[h];if(!f.extensions||!f.extensions[this.name])return Promise.resolve();const e=[],b=f.extensions[this.name];if(void 0!==b.clearcoatFactor&&(c.clearcoat=b.clearcoatFactor),void 0!==b.clearcoatTexture&&e.push(d.assignTexture(c,"clearcoatMap",b.clearcoatTexture)),void 0!==b.clearcoatRoughnessFactor&&(c.clearcoatRoughness=b.clearcoatRoughnessFactor),void 0!==b.clearcoatRoughnessTexture&&e.push(d.assignTexture(c,"clearcoatRoughnessMap",b.clearcoatRoughnessTexture)),void 0!==b.clearcoatNormalTexture&&(e.push(d.assignTexture(c,"clearcoatNormalMap",b.clearcoatNormalTexture)),void 0!==b.clearcoatNormalTexture.scale)){const g=b.clearcoatNormalTexture.scale;c.clearcoatNormalScale=new a.FM8(g,g)}return Promise.all(e)}}class k{constructor(a){this.parser=a,this.name=g.KHR_MATERIALS_SHEEN}getMaterialType(c){const d=this.parser,b=d.json.materials[c];return b.extensions&&b.extensions[this.name]?a.EJi:null}extendMaterialParams(g,c){const d=this.parser,e=d.json.materials[g];if(!e.extensions||!e.extensions[this.name])return Promise.resolve();const f=[];c.sheenColor=new a.Ilk(0,0,0),c.sheenRoughness=0,c.sheen=1;const b=e.extensions[this.name];return void 0!==b.sheenColorFactor&&c.sheenColor.fromArray(b.sheenColorFactor),void 0!==b.sheenRoughnessFactor&&(c.sheenRoughness=b.sheenRoughnessFactor),void 0!==b.sheenColorTexture&&f.push(d.assignTexture(c,"sheenColorMap",b.sheenColorTexture,a.knz)),void 0!==b.sheenRoughnessTexture&&f.push(d.assignTexture(c,"sheenRoughnessMap",b.sheenRoughnessTexture)),Promise.all(f)}}class l{constructor(a){this.parser=a,this.name=g.KHR_MATERIALS_TRANSMISSION}getMaterialType(c){const d=this.parser,b=d.json.materials[c];return b.extensions&&b.extensions[this.name]?a.EJi:null}extendMaterialParams(f,c){const d=this.parser,b=d.json.materials[f];if(!b.extensions||!b.extensions[this.name])return Promise.resolve();const e=[],a=b.extensions[this.name];return void 0!==a.transmissionFactor&&(c.transmission=a.transmissionFactor),void 0!==a.transmissionTexture&&e.push(d.assignTexture(c,"transmissionMap",a.transmissionTexture)),Promise.all(e)}}class m{constructor(a){this.parser=a,this.name=g.KHR_MATERIALS_VOLUME}getMaterialType(c){const d=this.parser,b=d.json.materials[c];return b.extensions&&b.extensions[this.name]?a.EJi:null}extendMaterialParams(h,c){const f=this.parser,d=f.json.materials[h];if(!d.extensions||!d.extensions[this.name])return Promise.resolve();const g=[],b=d.extensions[this.name];c.thickness=void 0!==b.thicknessFactor?b.thicknessFactor:0,void 0!==b.thicknessTexture&&g.push(f.assignTexture(c,"thicknessMap",b.thicknessTexture)),c.attenuationDistance=b.attenuationDistance||0;const e=b.attenuationColor||[1,1,1];return c.attenuationColor=new a.Ilk(e[0],e[1],e[2]),Promise.all(g)}}class n{constructor(a){this.parser=a,this.name=g.KHR_MATERIALS_IOR}getMaterialType(c){const d=this.parser,b=d.json.materials[c];return b.extensions&&b.extensions[this.name]?a.EJi:null}extendMaterialParams(c,d){const e=this.parser,a=e.json.materials[c];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const b=a.extensions[this.name];return d.ior=void 0!==b.ior?b.ior:1.5,Promise.resolve()}}class o{constructor(a){this.parser=a,this.name=g.KHR_MATERIALS_SPECULAR}getMaterialType(c){const d=this.parser,b=d.json.materials[c];return b.extensions&&b.extensions[this.name]?a.EJi:null}extendMaterialParams(h,c){const d=this.parser,e=d.json.materials[h];if(!e.extensions||!e.extensions[this.name])return Promise.resolve();const f=[],b=e.extensions[this.name];c.specularIntensity=void 0!==b.specularFactor?b.specularFactor:1,void 0!==b.specularTexture&&f.push(d.assignTexture(c,"specularIntensityMap",b.specularTexture));const g=b.specularColorFactor||[1,1,1];return c.specularColor=new a.Ilk(g[0],g[1],g[2]),void 0!==b.specularColorTexture&&f.push(d.assignTexture(c,"specularColorMap",b.specularColorTexture,a.knz)),Promise.all(f)}}class p{constructor(a){this.parser=a,this.name=g.KHR_TEXTURE_BASISU}loadTexture(d){const a=this.parser,b=a.json,c=b.textures[d];if(!c.extensions||!c.extensions[this.name])return null;const f=c.extensions[this.name],e=a.options.ktx2Loader;if(!e){if(!(b.extensionsRequired&&b.extensionsRequired.indexOf(this.name)>=0))return null;throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures")}return a.loadTextureImage(d,f.source,e)}}class q{constructor(a){this.parser=a,this.name=g.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(g){const c=this.name,a=this.parser,d=a.json,b=d.textures[g];if(!b.extensions||!b.extensions[c])return null;const h=b.extensions[c],e=d.images[h.source];let i=a.textureLoader;if(e.uri){const f=a.options.manager.getHandler(e.uri);null!==f&&(i=f)}return this.detectSupport().then(function(b){if(b)return a.loadTextureImage(g,h.source,i);if(d.extensionsRequired&&d.extensionsRequired.indexOf(c)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return a.loadTexture(g)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(b){const a=new Image;a.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",a.onload=a.onerror=function(){b(1===a.height)}})),this.isSupported}}class r{constructor(a){this.name=g.EXT_MESHOPT_COMPRESSION,this.parser=a}loadBufferView(d){const a=this.parser.json,b=a.bufferViews[d];if(!b.extensions||!b.extensions[this.name])return null;{const e=b.extensions[this.name],f=this.parser.getDependency("buffer",e.buffer),c=this.parser.options.meshoptDecoder;if(!c||!c.supported){if(!(a.extensionsRequired&&a.extensionsRequired.indexOf(this.name)>=0))return null;throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files")}return Promise.all([f,c.ready]).then(function(f){const g=e.byteOffset||0,h=e.byteLength||0,a=e.count,b=e.byteStride,d=new ArrayBuffer(a*b),i=new Uint8Array(f[0],g,h);return c.decodeGltfBuffer(new Uint8Array(d),a,b,i,e.mode,e.filter),d})}}}const s="glTF",t=12,u={JSON:1313821514,BIN:5130562};class v{constructor(c){this.name=g.KHR_BINARY_GLTF,this.content=null,this.body=null;const e=new DataView(c,0,t);if(this.header={magic:a.Zp0.decodeText(new Uint8Array(c.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==s)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const j=this.header.length-t,f=new DataView(c,t);let b=0;for(;b<j;){const d=f.getUint32(b,!0);b+=4;const h=f.getUint32(b,!0);if(b+=4,h===u.JSON){const k=new Uint8Array(c,t+b,d);this.content=a.Zp0.decodeText(k)}else if(h===u.BIN){const i=t+b;this.body=c.slice(i,i+d)}b+=d}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class w{constructor(b,a){if(!a)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=g.KHR_DRACO_MESH_COMPRESSION,this.json=b,this.dracoLoader=a,this.dracoLoader.preload()}decodePrimitive(a,g){const h=this.json,o=this.dracoLoader,i=a.extensions[this.name].bufferView,c=a.extensions[this.name].attributes,j={},k={},l={};for(const d in c){const m=I[d]||d.toLowerCase();j[m]=c[d]}for(const b in a.attributes){const e=I[b]||b.toLowerCase();if(void 0!==c[b]){const f=h.accessors[a.attributes[b]],n=E[f.componentType];l[e]=n,k[e]=!0===f.normalized}}return g.getDependency("bufferView",i).then(function(a){return new Promise(function(b){o.decodeDracoFile(a,function(a){for(const c in a.attributes){const e=a.attributes[c],d=k[c];void 0!==d&&(e.normalized=d)}b(a)},j,l)})})}}class x{constructor(){this.name=g.KHR_TEXTURE_TRANSFORM}extendTexture(b,a){return void 0!==a.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),void 0===a.offset&& void 0===a.rotation&& void 0===a.scale||(b=b.clone(),void 0!==a.offset&&b.offset.fromArray(a.offset),void 0!==a.rotation&&(b.rotation=a.rotation),void 0!==a.scale&&b.repeat.fromArray(a.scale),b.needsUpdate=!0),b}}class y extends a.Wid{constructor(b){super(),this.isGLTFSpecularGlossinessMaterial=!0;const c={specular:{value:new a.Ilk().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=c,this.onBeforeCompile=function(a){for(const b in c)a.uniforms[b]=c[b];a.fragmentShader=a.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>","#ifdef USE_SPECULARMAP\n	uniform sampler2D specularMap;\n#endif").replace("#include <metalnessmap_pars_fragment>","#ifdef USE_GLOSSINESSMAP\n	uniform sampler2D glossinessMap;\n#endif").replace("#include <roughnessmap_fragment>","vec3 specularFactor = specular;\n#ifdef USE_SPECULARMAP\n	vec4 texelSpecular = texture2D( specularMap, vUv );\n	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture\n	specularFactor *= texelSpecular.rgb;\n#endif").replace("#include <metalnessmap_fragment>","float glossinessFactor = glossiness;\n#ifdef USE_GLOSSINESSMAP\n	vec4 texelGlossiness = texture2D( glossinessMap, vUv );\n	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture\n	glossinessFactor *= texelGlossiness.a;\n#endif").replace("#include <lights_physical_fragment>","PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.\nmaterial.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\nmaterial.specularColor = specularFactor;")},Object.defineProperties(this,{specular:{get:function(){return c.specular.value},set:function(a){c.specular.value=a}},specularMap:{get:function(){return c.specularMap.value},set:function(a){c.specularMap.value=a,a?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return c.glossiness.value},set:function(a){c.glossiness.value=a}},glossinessMap:{get:function(){return c.glossinessMap.value},set:function(a){c.glossinessMap.value=a,a?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(b)}copy(a){return super.copy(a),this.specularMap=a.specularMap,this.specular.copy(a.specular),this.glossinessMap=a.glossinessMap,this.glossiness=a.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class z{constructor(){this.name=g.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity"]}getMaterialType(){return y}extendParams(b,h,e){const c=h.extensions[this.name];b.color=new a.Ilk(1,1,1),b.opacity=1;const d=[];if(Array.isArray(c.diffuseFactor)){const f=c.diffuseFactor;b.color.fromArray(f),b.opacity=f[3]}if(void 0!==c.diffuseTexture&&d.push(e.assignTexture(b,"map",c.diffuseTexture,a.knz)),b.emissive=new a.Ilk(0,0,0),b.glossiness=void 0!==c.glossinessFactor?c.glossinessFactor:1,b.specular=new a.Ilk(1,1,1),Array.isArray(c.specularFactor)&&b.specular.fromArray(c.specularFactor),void 0!==c.specularGlossinessTexture){const g=c.specularGlossinessTexture;d.push(e.assignTexture(b,"glossinessMap",g)),d.push(e.assignTexture(b,"specularMap",g,a.knz))}return Promise.all(d)}createMaterial(c){const b=new y(c);return b.fog=!0,b.color=c.color,b.map=void 0===c.map?null:c.map,b.lightMap=null,b.lightMapIntensity=1,b.aoMap=void 0===c.aoMap?null:c.aoMap,b.aoMapIntensity=1,b.emissive=c.emissive,b.emissiveIntensity=1,b.emissiveMap=void 0===c.emissiveMap?null:c.emissiveMap,b.bumpMap=void 0===c.bumpMap?null:c.bumpMap,b.bumpScale=1,b.normalMap=void 0===c.normalMap?null:c.normalMap,b.normalMapType=a.IOt,c.normalScale&&(b.normalScale=c.normalScale),b.displacementMap=null,b.displacementScale=1,b.displacementBias=0,b.specularMap=void 0===c.specularMap?null:c.specularMap,b.specular=c.specular,b.glossinessMap=void 0===c.glossinessMap?null:c.glossinessMap,b.glossiness=c.glossiness,b.alphaMap=null,b.envMap=void 0===c.envMap?null:c.envMap,b.envMapIntensity=1,b}}class A{constructor(){this.name=g.KHR_MESH_QUANTIZATION}}class b extends a._C8{constructor(a,b,c,d){super(a,b,c,d)}copySampleValue_(d){const c=this.resultBuffer,e=this.sampleValues,b=this.valueSize,f=d*b*3+b;for(let a=0;a!==b;a++)c[a]=e[f+a];return c}}b.prototype.beforeStart_=b.prototype.copySampleValue_,b.prototype.afterEnd_=b.prototype.copySampleValue_,b.prototype.interpolate_=function(o,h,p,q){const i=this.resultBuffer,c=this.sampleValues,b=this.valueSize,r=2*b,j=3*b,f=q-h,d=(p-h)/f,e=d*d,k=e*d,g=o*j,l=g-j,m=-2*k+3*e,n=k-e,s=1-m,t=n-e+d;for(let a=0;a!==b;a++){const u=c[l+a+b],v=c[l+a+r]*f,w=c[g+a+b],x=c[g+a]*f;i[a]=s*u+t*v+m*w+n*x}return i};const B=new a._fP;class C extends b{interpolate_(b,c,d,e){const a=super.interpolate_(b,c,d,e);return B.fromArray(a).normalize().toArray(a),a}}const D={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},E={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},F={9728:a.TyD,9729:a.wem,9984:a.YLQ,9985:a.qyh,9986:a.aH4,9987:a.D1R},G={33071:a.uWy,33648:a.OoA,10497:a.rpg},H={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},I={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},J={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},K={CUBICSPLINE:void 0,LINEAR:a.NMF,STEP:a.Syv},L={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function M(b){return void 0===b.DefaultMaterial&&(b.DefaultMaterial=new a.Wid({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:a.Wl3})),b.DefaultMaterial}function N(d,a,c){for(const b in c.extensions)void 0===d[b]&&(a.userData.gltfExtensions=a.userData.gltfExtensions||{},a.userData.gltfExtensions[b]=c.extensions[b])}function O(b,a){void 0!==a.extras&&("object"==typeof a.extras?Object.assign(b.userData,a.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+a.extras))}function P(b,a){if(b.updateMorphTargets(),void 0!==a.weights)for(let c=0,f=a.weights.length;c<f;c++)b.morphTargetInfluences[c]=a.weights[c];if(a.extras&&Array.isArray(a.extras.targetNames)){const e=a.extras.targetNames;if(b.morphTargetInfluences.length===e.length){b.morphTargetDictionary={};for(let d=0,g=e.length;d<g;d++)b.morphTargetDictionary[e[d]]=d}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Q(a){const b=a.extensions&&a.extensions[g.KHR_DRACO_MESH_COMPRESSION];return b?"draco:"+b.bufferView+":"+b.indices+":"+R(b.attributes):a.indices+":"+R(a.attributes)+":"+a.mode}function R(c){let d="";const b=Object.keys(c).sort();for(let a=0,e=b.length;a<e;a++)d+=b[a]+":"+c[b[a]]+";";return d}function S(a){switch(a){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class T{constructor(b={},c={}){this.json=b,this.extensions={},this.plugins={},this.options=c,this.cache=new function(){let a={};return{get:function(b){return a[b]},add:function(b,c){a[b]=c},remove:function(b){delete a[b]},removeAll:function(){a={}}}},this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={},"undefined"!=typeof createImageBitmap&& !1===/^((?!chrome|android).)*safari/i.test(navigator.userAgent)?this.textureLoader=new a.QRU(this.options.manager):this.textureLoader=new a.dpR(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new a.hH6(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(a){this.extensions=a}setPlugins(a){this.plugins=a}parse(b,a){const c=this,d=this.json,e=this.extensions;this.cache.removeAll(),this._invokeAll(function(a){return a._markDefs&&a._markDefs()}),Promise.all(this._invokeAll(function(a){return a.beforeRoot&&a.beforeRoot()})).then(function(){return Promise.all([c.getDependencies("scene"),c.getDependencies("animation"),c.getDependencies("camera"),])}).then(function(a){const f={scene:a[0][d.scene||0],scenes:a[0],animations:a[1],cameras:a[2],asset:d.asset,parser:c,userData:{}};N(e,f,d),O(f,d),Promise.all(c._invokeAll(function(a){return a.afterRoot&&a.afterRoot(f)})).then(function(){b(f)})}).catch(a)}_markDefs(){const b=this.json.nodes||[],f=this.json.skins||[],h=this.json.meshes||[];for(let c=0,i=f.length;c<i;c++){const g=f[c].joints;for(let d=0,j=g.length;d<j;d++)b[g[d]].isBone=!0}for(let e=0,k=b.length;e<k;e++){const a=b[e];void 0!==a.mesh&&(this._addNodeRef(this.meshCache,a.mesh),void 0!==a.skin&&(h[a.mesh].isSkinnedMesh=!0)),void 0!==a.camera&&this._addNodeRef(this.cameraCache,a.camera)}}_addNodeRef(b,a){void 0!==a&&(void 0===b.refs[a]&&(b.refs[a]=b.uses[a]=0),b.refs[a]++)}_getNodeRef(c,d,a){if(c.refs[d]<=1)return a;const b=a.clone(),e=(a,b)=>{const c=this.associations.get(a);for(const[d,f]of(null!=c&&this.associations.set(b,c),a.children.entries()))e(f,b.children[d])};return e(a,b),b.name+="_instance_"+c.uses[d]++,b}_invokeOne(d){const a=Object.values(this.plugins);a.push(this);for(let b=0;b<a.length;b++){const c=d(a[b]);if(c)return c}return null}_invokeAll(e){const a=Object.values(this.plugins);a.unshift(this);const c=[];for(let b=0;b<a.length;b++){const d=e(a[b]);d&&c.push(d)}return c}getDependency(c,b){const d=c+":"+b;let a=this.cache.get(d);if(!a){switch(c){case"scene":a=this.loadScene(b);break;case"node":a=this.loadNode(b);break;case"mesh":a=this._invokeOne(function(a){return a.loadMesh&&a.loadMesh(b)});break;case"accessor":a=this.loadAccessor(b);break;case"bufferView":a=this._invokeOne(function(a){return a.loadBufferView&&a.loadBufferView(b)});break;case"buffer":a=this.loadBuffer(b);break;case"material":a=this._invokeOne(function(a){return a.loadMaterial&&a.loadMaterial(b)});break;case"texture":a=this._invokeOne(function(a){return a.loadTexture&&a.loadTexture(b)});break;case"skin":a=this.loadSkin(b);break;case"animation":a=this.loadAnimation(b);break;case"camera":a=this.loadCamera(b);break;default:throw new Error("Unknown type: "+c)}this.cache.add(d,a)}return a}getDependencies(a){let b=this.cache.get(a);if(!b){const d=this,c=this.json[a+("mesh"===a?"es":"s")]||[];b=Promise.all(c.map(function(c,b){return d.getDependency(a,b)})),this.cache.add(a,b)}return b}loadBuffer(c){const b=this.json.buffers[c],d=this.fileLoader;if(b.type&&"arraybuffer"!==b.type)throw new Error("THREE.GLTFLoader: "+b.type+" buffer type is not supported.");if(void 0===b.uri&&0===c)return Promise.resolve(this.extensions[g.KHR_BINARY_GLTF].body);const e=this.options;return new Promise(function(c,f){d.load(a.Zp0.resolveURL(b.uri,e.path),c,void 0,function(){f(new Error('THREE.GLTFLoader: Failed to load buffer "'+b.uri+'".'))})})}loadBufferView(a){const b=this.json.bufferViews[a];return this.getDependency("buffer",b.buffer).then(function(c){const d=b.byteLength||0,a=b.byteOffset||0;return c.slice(a,a+d)})}loadAccessor(d){const e=this,f=this.json,b=this.json.accessors[d];if(void 0===b.bufferView&& void 0===b.sparse)return Promise.resolve(null);const c=[];return void 0!==b.bufferView?c.push(this.getDependency("bufferView",b.bufferView)):c.push(null),void 0!==b.sparse&&(c.push(this.getDependency("bufferView",b.sparse.indices.bufferView)),c.push(this.getDependency("bufferView",b.sparse.values.bufferView))),Promise.all(c).then(function(p){const j=p[0],c=H[b.type],i=E[b.componentType],k=i.BYTES_PER_ELEMENT,q=b.byteOffset||0,g=void 0!==b.bufferView?f.bufferViews[b.bufferView].byteStride:void 0,r=!0===b.normalized;let l,d;if(g&&g!==k*c){const s=Math.floor(q/g),t="InterleavedBuffer:"+b.bufferView+":"+b.componentType+":"+s+":"+b.count;let m=e.cache.get(t);m||(l=new i(j,s*g,b.count*g/k),m=new a.vpT(l,g/k),e.cache.add(t,m)),d=new a.kB5(m,c,q%g/k,r)}else l=null===j?new i(b.count*c):new i(j,q,b.count*c),d=new a.TlE(l,c,r);if(void 0!==b.sparse){const v=H.SCALAR,w=E[b.sparse.indices.componentType],x=b.sparse.indices.byteOffset||0,y=b.sparse.values.byteOffset||0,u=new w(p[1],x,b.sparse.count*v),n=new i(p[2],y,b.sparse.count*c);null!==j&&(d=new a.TlE(d.array.slice(),d.itemSize,d.normalized));for(let h=0,z=u.length;h<z;h++){const o=u[h];if(d.setX(o,n[h*c]),c>=2&&d.setY(o,n[h*c+1]),c>=3&&d.setZ(o,n[h*c+2]),c>=4&&d.setW(o,n[h*c+3]),c>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return d})}loadTexture(a){const b=this.json,g=this.options,h=b.textures[a],c=h.source,d=b.images[c];let e=this.textureLoader;if(d.uri){const f=g.manager.getHandler(d.uri);null!==f&&(e=f)}return this.loadTextureImage(a,c,e)}loadTextureImage(g,c,h){const j=this,d=this.json,i=d.textures[g],e=d.images[c],b=(e.uri||e.bufferView)+":"+i.sampler;if(this.textureCache[b])return this.textureCache[b];const f=this.loadImageSource(c,h).then(function(b){b.flipY=!1,i.name&&(b.name=i.name);const e=d.samplers||{},c=e[i.sampler]||{};return b.magFilter=F[c.magFilter]||a.wem,b.minFilter=F[c.minFilter]||a.D1R,b.wrapS=G[c.wrapS]||a.rpg,b.wrapT=G[c.wrapT]||a.rpg,j.associations.set(b,{textures:g}),b}).catch(function(){return null});return this.textureCache[b]=f,f}loadImageSource(b,g){const f=this.json,h=this.options;if(void 0!==this.sourceCache[b])return this.sourceCache[b].then(a=>a.clone());const c=f.images[b],i=self.URL||self.webkitURL;let d=c.uri||"",j=!1;if(void 0!==c.bufferView)d=this.getDependency("bufferView",c.bufferView).then(function(a){j=!0;const b=new Blob([a],{type:c.mimeType});return d=i.createObjectURL(b)});else if(void 0===c.uri)throw new Error("THREE.GLTFLoader: Image "+b+" is missing URI and bufferView");const e=Promise.resolve(d).then(function(b){return new Promise(function(d,e){let c=d;!0===g.isImageBitmapLoader&&(c=function(c){const b=new a.xEZ(c);b.needsUpdate=!0,d(b)}),g.load(a.Zp0.resolveURL(b,h.path),c,void 0,e)})}).then(function(b){var a;return!0===j&&i.revokeObjectURL(d),b.userData.mimeType=c.mimeType||((a=c.uri).search(/\.jpe?g($|\?)/i)>0||0===a.search(/^data\:image\/jpeg/)?"image/jpeg":a.search(/\.webp($|\?)/i)>0||0===a.search(/^data\:image\/webp/)?"image/webp":"image/png"),b}).catch(function(a){throw console.error("THREE.GLTFLoader: Couldn't load texture",d),a});return this.sourceCache[b]=e,e}assignTexture(b,c,a,d){const e=this;return this.getDependency("texture",a.index).then(function(f){if(void 0===a.texCoord||0==a.texCoord||"aoMap"===c&&1==a.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+a.texCoord+" for texture "+c+" not yet supported."),e.extensions[g.KHR_TEXTURE_TRANSFORM]){const h=void 0!==a.extensions?a.extensions[g.KHR_TEXTURE_TRANSFORM]:void 0;if(h){const i=e.associations.get(f);f=e.extensions[g.KHR_TEXTURE_TRANSFORM].extendTexture(f,h),e.associations.set(f,i)}}return void 0!==d&&(f.encoding=d),b[c]=f,f})}assignFinalMaterial(h){const e=h.geometry;let b=h.material;const i=void 0===e.attributes.tangent,j=void 0!==e.attributes.color,k=void 0===e.attributes.normal;if(h.isPoints){const l="PointsMaterial:"+b.uuid;let d=this.cache.get(l);d||(d=new a.UY4,a.F5T.prototype.copy.call(d,b),d.color.copy(b.color),d.map=b.map,d.sizeAttenuation=!1,this.cache.add(l,d)),b=d}else if(h.isLine){const m="LineBasicMaterial:"+b.uuid;let f=this.cache.get(m);f||(f=new a.nls,a.F5T.prototype.copy.call(f,b),f.color.copy(b.color),this.cache.add(m,f)),b=f}if(i||j||k){let g="ClonedMaterial:"+b.uuid+":";b.isGLTFSpecularGlossinessMaterial&&(g+="specular-glossiness:"),i&&(g+="derivative-tangents:"),j&&(g+="vertex-colors:"),k&&(g+="flat-shading:");let c=this.cache.get(g);c||(c=b.clone(),j&&(c.vertexColors=!0),k&&(c.flatShading=!0),i&&(c.normalScale&&(c.normalScale.y*=-1),c.clearcoatNormalScale&&(c.clearcoatNormalScale.y*=-1)),this.cache.add(g,c),this.associations.set(c,this.associations.get(b))),b=c}b.aoMap&& void 0===e.attributes.uv2&& void 0!==e.attributes.uv&&e.setAttribute("uv2",e.attributes.uv),h.material=b}getMaterialType(){return a.Wid}loadMaterial(p){const f=this,q=this.json,i=this.extensions,c=q.materials[p];let h;const b={},j=c.extensions||{},e=[];if(j[g.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const k=i[g.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];h=k.getMaterialType(),e.push(k.extendParams(b,c,f))}else if(j[g.KHR_MATERIALS_UNLIT]){const l=i[g.KHR_MATERIALS_UNLIT];h=l.getMaterialType(),e.push(l.extendParams(b,c,f))}else{const d=c.pbrMetallicRoughness||{};if(b.color=new a.Ilk(1,1,1),b.opacity=1,Array.isArray(d.baseColorFactor)){const m=d.baseColorFactor;b.color.fromArray(m),b.opacity=m[3]}void 0!==d.baseColorTexture&&e.push(f.assignTexture(b,"map",d.baseColorTexture,a.knz)),b.metalness=void 0!==d.metallicFactor?d.metallicFactor:1,b.roughness=void 0!==d.roughnessFactor?d.roughnessFactor:1,void 0!==d.metallicRoughnessTexture&&(e.push(f.assignTexture(b,"metalnessMap",d.metallicRoughnessTexture)),e.push(f.assignTexture(b,"roughnessMap",d.metallicRoughnessTexture))),h=this._invokeOne(function(a){return a.getMaterialType&&a.getMaterialType(p)}),e.push(Promise.all(this._invokeAll(function(a){return a.extendMaterialParams&&a.extendMaterialParams(p,b)})))}!0===c.doubleSided&&(b.side=a.ehD);const n=c.alphaMode||L.OPAQUE;if(n===L.BLEND?(b.transparent=!0,b.depthWrite=!1):(b.transparent=!1,n===L.MASK&&(b.alphaTest=void 0!==c.alphaCutoff?c.alphaCutoff:.5)),void 0!==c.normalTexture&&h!==a.vBJ&&(e.push(f.assignTexture(b,"normalMap",c.normalTexture)),b.normalScale=new a.FM8(1,1),void 0!==c.normalTexture.scale)){const o=c.normalTexture.scale;b.normalScale.set(o,o)}return void 0!==c.occlusionTexture&&h!==a.vBJ&&(e.push(f.assignTexture(b,"aoMap",c.occlusionTexture)),void 0!==c.occlusionTexture.strength&&(b.aoMapIntensity=c.occlusionTexture.strength)),void 0!==c.emissiveFactor&&h!==a.vBJ&&(b.emissive=new a.Ilk().fromArray(c.emissiveFactor)),void 0!==c.emissiveTexture&&h!==a.vBJ&&e.push(f.assignTexture(b,"emissiveMap",c.emissiveTexture,a.knz)),Promise.all(e).then(function(){let a;return a=h===y?i[g.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(b):new h(b),c.name&&(a.name=c.name),O(a,c),f.associations.set(a,{materials:p}),c.extensions&&N(i,a,c),a})}createUniqueName(e){const c=a.iUV.sanitizeNodeName(e||"");let b=c;for(let d=1;this.nodeNamesUsed[b];++d)b=c+"_"+d;return this.nodeNamesUsed[b]=!0,b}loadGeometries(f){const k=this,n=this.extensions,h=this.primitiveCache;function l(a){return n[g.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,k).then(function(b){return V(b,a,k)})}const c=[];for(let d=0,m=f.length;d<m;d++){const b=f[d],i=Q(b),j=h[i];if(j)c.push(j.promise);else{let e;e=b.extensions&&b.extensions[g.KHR_DRACO_MESH_COMPRESSION]?l(b):V(new a.u9r,b,k),h[i]={primitive:b,promise:e},c.push(e)}}return Promise.all(c)}loadMesh(e){const f=this,g=this.json,k=this.extensions,h=g.meshes[e],b=h.primitives,d=[];for(let c=0,i=b.length;c<i;c++){const j=void 0===b[c].material?M(this.cache):this.getDependency("material",b[c].material);d.push(j)}return d.push(f.loadGeometries(b)),Promise.all(d).then(function(m){const r=m.slice(0,m.length-1),q=m[m.length-1],g=[];for(let l=0,s=q.length;l<s;l++){const i=q[l],d=b[l];let c;const j=r[l];if(d.mode===D.TRIANGLES||d.mode===D.TRIANGLE_STRIP||d.mode===D.TRIANGLE_FAN|| void 0===d.mode)!0!==(c=!0===h.isSkinnedMesh?new a.TUv(i,j):new a.Kj0(i,j)).isSkinnedMesh||c.geometry.attributes.skinWeight.normalized||c.normalizeSkinWeights(),d.mode===D.TRIANGLE_STRIP?c.geometry=W(c.geometry,a.UlW):d.mode===D.TRIANGLE_FAN&&(c.geometry=W(c.geometry,a.z$h));else if(d.mode===D.LINES)c=new a.ejS(i,j);else if(d.mode===D.LINE_STRIP)c=new a.x12(i,j);else if(d.mode===D.LINE_LOOP)c=new a.blk(i,j);else if(d.mode===D.POINTS)c=new a.woe(i,j);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+d.mode);Object.keys(c.geometry.morphAttributes).length>0&&P(c,h),c.name=f.createUniqueName(h.name||"mesh_"+e),O(c,h),d.extensions&&N(k,c,d),f.assignFinalMaterial(c),g.push(c)}for(let n=0,t=g.length;n<t;n++)f.associations.set(g[n],{meshes:e,primitives:n});if(1===g.length)return g[0];const o=new a.ZAu;f.associations.set(o,{meshes:e});for(let p=0,u=g.length;p<u;p++)o.add(g[p]);return o})}loadCamera(e){let d;const c=this.json.cameras[e],b=c[c.type];if(!b){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return"perspective"===c.type?d=new a.cPb(a.M8C.radToDeg(b.yfov),b.aspectRatio||1,b.znear||1,b.zfar||2e6):"orthographic"===c.type&&(d=new a.iKG(-b.xmag,b.xmag,b.ymag,-b.ymag,b.znear,b.zfar)),c.name&&(d.name=this.createUniqueName(c.name)),O(d,c),Promise.resolve(d)}loadSkin(b){const a=this.json.skins[b],c={joints:a.joints};return void 0===a.inverseBindMatrices?Promise.resolve(c):this.getDependency("accessor",a.inverseBindMatrices).then(function(a){return c.inverseBindMatrices=a,c})}loadAnimation(m){const n=this.json,c=n.animations[m],g=[],h=[],i=[],j=[],k=[];for(let f=0,o=c.channels.length;f<o;f++){const l=c.channels[f],d=c.samplers[l.sampler],e=l.target,p=void 0!==e.node?e.node:e.id,q=void 0!==c.parameters?c.parameters[d.input]:d.input,r=void 0!==c.parameters?c.parameters[d.output]:d.output;g.push(this.getDependency("node",p)),h.push(this.getDependency("accessor",q)),i.push(this.getDependency("accessor",r)),j.push(d),k.push(e)}return Promise.all([Promise.all(g),Promise.all(h),Promise.all(i),Promise.all(j),Promise.all(k)]).then(function(g){const p=g[0],t=g[1],u=g[2],v=g[3],w=g[4],q=[];for(let d=0,x=p.length;d<x;d++){const e=p[d],y=t[d],r=u[d],j=v[d],k=w[d];if(void 0===e)continue;e.updateMatrix(),e.matrixAutoUpdate=!0;let h;switch(J[k.path]){case J.weights:h=a.dUE;break;case J.rotation:h=a.iLg;break;case J.position:case J.scale:default:h=a.yC1;break}const z=e.name?e.name:e.uuid,A=void 0!==j.interpolation?K[j.interpolation]:a.NMF,l=[];J[k.path]===J.weights?e.traverse(function(a){a.morphTargetInfluences&&l.push(a.name?a.name:a.uuid)}):l.push(z);let f=r.array;if(r.normalized){const B=S(f.constructor),s=new Float32Array(f.length);for(let i=0,D=f.length;i<D;i++)s[i]=f[i]*B;f=s}for(let n=0,E=l.length;n<E;n++){const o=new h(l[n]+"."+J[k.path],y.array,f,A);"CUBICSPLINE"===j.interpolation&&(o.createInterpolant=function(c){const d=this instanceof a.iLg?C:b;return new d(this.times,this.values,this.getValueSize()/3,c)},o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),q.push(o)}}const F=c.name?c.name:"animation_"+m;return new a.m7l(F,void 0,q)})}createNodeMesh(b){const c=this.json,d=this,a=c.nodes[b];return void 0===a.mesh?null:d.getDependency("mesh",a.mesh).then(function(c){const b=d._getNodeRef(d.meshCache,a.mesh,c);return void 0!==a.weights&&b.traverse(function(c){if(c.isMesh)for(let b=0,d=a.weights.length;b<d;b++)c.morphTargetInfluences[b]=a.weights[b]}),b})}loadNode(c){const d=this.json,f=this.extensions,e=this,b=d.nodes[c],g=b.name?e.createUniqueName(b.name):"";return(function(){const a=[],d=e._invokeOne(function(a){return a.createNodeMesh&&a.createNodeMesh(c)});return d&&a.push(d),void 0!==b.camera&&a.push(e.getDependency("camera",b.camera).then(function(a){return e._getNodeRef(e.cameraCache,b.camera,a)})),e._invokeAll(function(a){return a.createNodeAttachment&&a.createNodeAttachment(c)}).forEach(function(b){a.push(b)}),Promise.all(a)})().then(function(h){let d;if((d=!0===b.isBone?new a.N$j:h.length>1?new a.ZAu:1===h.length?h[0]:new a.Tme)!==h[0])for(let i=0,k=h.length;i<k;i++)d.add(h[i]);if(b.name&&(d.userData.name=b.name,d.name=g),O(d,b),b.extensions&&N(f,d,b),void 0!==b.matrix){const j=new a.yGw;j.fromArray(b.matrix),d.applyMatrix4(j)}else void 0!==b.translation&&d.position.fromArray(b.translation),void 0!==b.rotation&&d.quaternion.fromArray(b.rotation),void 0!==b.scale&&d.scale.fromArray(b.scale);return e.associations.has(d)||e.associations.set(d,{}),e.associations.get(d).nodes=c,d})}loadScene(h){const i=this.json,j=this.extensions,b=this.json.scenes[h],e=this,c=new a.ZAu;b.name&&(c.name=e.createUniqueName(b.name)),O(c,b),b.extensions&&N(j,c,b);const f=b.nodes||[],g=[];for(let d=0,k=f.length;d<k;d++)g.push(U(f[d],c,i,e));return Promise.all(g).then(function(){return e.associations=(d=>{const c=new Map;for(const[b,f]of e.associations)(b instanceof a.F5T||b instanceof a.xEZ)&&c.set(b,f);return d.traverse(a=>{const b=e.associations.get(a);null!=b&&c.set(a,b)}),c})(c),c})}}function U(b,e,c,d){const f=c.nodes[b];return d.getDependency("node",b).then(function(b){if(void 0===f.skin)return b;let c;return d.getDependency("skin",f.skin).then(function(e){c=e;const b=[];for(let a=0,f=c.joints.length;a<f;a++)b.push(d.getDependency("node",c.joints[a]));return Promise.all(b)}).then(function(d){return b.traverse(function(e){if(!e.isMesh)return;const f=[],g=[];for(let b=0,j=d.length;b<j;b++){const h=d[b];if(h){f.push(h);const i=new a.yGw;void 0!==c.inverseBindMatrices&&i.fromArray(c.inverseBindMatrices.array,16*b),g.push(i)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',c.joints[b])}e.bind(new a.OdW(f,g),e.matrixWorld)}),b})}).then(function(b){e.add(b);const g=[];if(f.children){const h=f.children;for(let a=0,i=h.length;a<i;a++){const j=h[a];g.push(U(j,b,c,d))}}return Promise.all(g)})}function V(c,b,f){const g=b.attributes,d=[];function i(a,b){return f.getDependency("accessor",a).then(function(a){c.setAttribute(b,a)})}for(const e in g){const h=I[e]||e.toLowerCase();h in c.attributes||d.push(i(g[e],h))}if(void 0!==b.indices&&!c.index){const j=f.getDependency("accessor",b.indices).then(function(a){c.setIndex(a)});d.push(j)}return O(c,b),!function(m,n,o){const p=n.attributes,b=new a.ZzF;if(void 0===p.POSITION)return;{const d=o.json.accessors[p.POSITION],e=d.min,f=d.max;if(void 0!==e&& void 0!==f){if(b.set(new a.Pa4(e[0],e[1],e[2]),new a.Pa4(f[0],f[1],f[2])),d.normalized){const q=S(E[d.componentType]);b.min.multiplyScalar(q),b.max.multiplyScalar(q)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}const j=n.targets;if(void 0!==j){const r=new a.Pa4,c=new a.Pa4;for(let k=0,t=j.length;k<t;k++){const s=j[k];if(void 0!==s.POSITION){const g=o.json.accessors[s.POSITION],h=g.min,i=g.max;if(void 0!==h&& void 0!==i){if(c.setX(Math.max(Math.abs(h[0]),Math.abs(i[0]))),c.setY(Math.max(Math.abs(h[1]),Math.abs(i[1]))),c.setZ(Math.max(Math.abs(h[2]),Math.abs(i[2]))),g.normalized){const u=S(E[g.componentType]);c.multiplyScalar(u)}r.max(c)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}b.expandByVector(r)}m.boundingBox=b;const l=new a.aLr;b.getCenter(l.center),l.radius=b.min.distanceTo(b.max)/2,m.boundingSphere=l}(c,b,f),Promise.all(d).then(function(){return void 0!==b.targets?function(b,c,g){let d=!1,e=!1,f=!1;for(let h=0,n=c.length;h<n;h++){const i=c[h];if(void 0!==i.POSITION&&(d=!0),void 0!==i.NORMAL&&(e=!0),void 0!==i.COLOR_0&&(f=!0),d&&e&&f)break}if(!d&&!e&&!f)return Promise.resolve(b);const k=[],l=[],m=[];for(let j=0,o=c.length;j<o;j++){const a=c[j];if(d){const p=void 0!==a.POSITION?g.getDependency("accessor",a.POSITION):b.attributes.position;k.push(p)}if(e){const q=void 0!==a.NORMAL?g.getDependency("accessor",a.NORMAL):b.attributes.normal;l.push(q)}if(f){const r=void 0!==a.COLOR_0?g.getDependency("accessor",a.COLOR_0):b.attributes.color;m.push(r)}}return Promise.all([Promise.all(k),Promise.all(l),Promise.all(m)]).then(function(a){const c=a[0],g=a[1],h=a[2];return d&&(b.morphAttributes.position=c),e&&(b.morphAttributes.normal=g),f&&(b.morphAttributes.color=h),b.morphTargetsRelative=!0,b})}(c,b.targets,f):c})}function W(e,l){let b=e.getIndex();if(null===b){const i=[],j=e.getAttribute("position");if(void 0===j)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let g=0;g<j.count;g++)i.push(g);e.setIndex(i),b=e.getIndex()}const h=b.count-2,c=[];if(l===a.z$h)for(let f=1;f<=h;f++)c.push(b.getX(0)),c.push(b.getX(f)),c.push(b.getX(f+1));else for(let d=0;d<h;d++)d%2==0?(c.push(b.getX(d)),c.push(b.getX(d+1)),c.push(b.getX(d+2))):(c.push(b.getX(d+2)),c.push(b.getX(d+1)),c.push(b.getX(d)));c.length/3!==h&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const k=e.clone();return k.setIndex(c),k}}}])